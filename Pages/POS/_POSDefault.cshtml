@model WebPOS.Models.Business
@{
    var categories = ViewData["Categories"] as List<WebPOS.Models.Category> ?? new();
    var products = ViewData["Products"] as List<WebPOS.Models.Product> ?? new();
    var selectedCategoryId = ViewData["SelectedCategoryId"] as int?;
    var cart = ViewData["Cart"] as List<WebPOS.Models.CartItem> ?? new();
    var itemCount = cart.Sum(i => i.Quantity);
    decimal subtotal = cart.Sum(i => i.Subtotal);
    decimal tax = Math.Round(subtotal * 0.08M, 2); // 8% example tax
    decimal total = subtotal + tax;
}

<div class="container-fluid my-4">
    <div class="row">
        <!-- Main POS area (products/categories) -->
        <div class="col-md-8">
            <h2 class="mb-3">Select Category</h2>
            <div class="btn-group mb-4" role="group" aria-label="Categories">
                <a href="/POS" class="btn btn-outline-primary @(selectedCategoryId == null ? "active" : "")">All</a>
                @foreach (var category in categories)
                {
                    <a href="/POS?categoryId=@category.CategoryId"
                       class="btn btn-outline-primary @(selectedCategoryId == category.CategoryId ? "active" : "")">
                        @category.Name
                    </a>
                }
            </div>

            <h2 class="mb-3">Products</h2>
            <div class="row row-cols-2 row-cols-md-3 g-4">
                @foreach (var product in products)
                {
                    <div class="col">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column align-items-center">
                                <h5 class="card-title">@product.Name</h5>
                                <p class="card-text">@product.Price.ToString("C")</p>
                                <form asp-page-handler="AddToCart" method="post">
                                    <input type="hidden" name="productId" value="@product.ProductId" />
                                    <input type="hidden" name="categoryId" value="@selectedCategoryId" />
                                    <button type="submit" class="btn btn-success mt-auto">Add</button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Cart sidebar -->
        <div class="col-md-4">
            <div class="card shadow rounded-4 border-0" style="background:#151c2c;">
                <div class="card-header d-flex justify-content-between align-items-center rounded-top-4" style="background:#0a1740;">
                    <h4 class="mb-0 text-white">Cart</h4>
                    <span class="badge bg-white text-dark">@itemCount Item@(itemCount != 1 ? "s" : "")</span>
                </div>
                <div class="card-body pb-2 px-3" style="background:#151c2c;">
                    @if (cart != null && cart.Any())
                    {
                        @foreach (var item in cart)
                        {
                            <div class="d-flex align-items-center py-2 border-bottom border-secondary">
                                <div class="flex-grow-1">
                                    <div class="fw-semibold text-white">@item.ProductName</div>
                                    <div class="small text-secondary">@item.Price.ToString("C") each</div>
                                </div>
                                <form method="post" asp-page-handler="DecreaseQuantity" class="d-inline">
                                    <input type="hidden" name="productId" value="@item.ProductId" />
                                    <input type="hidden" name="categoryId" value="@selectedCategoryId" />
                                    <button class="btn btn-sm btn-light rounded-circle me-1" style="width:32px;height:32px;">–</button>
                                </form>
                                <span class="mx-1 text-white">@item.Quantity</span>
                                <form method="post" asp-page-handler="IncreaseQuantity" class="d-inline">
                                    <input type="hidden" name="productId" value="@item.ProductId" />
                                    <input type="hidden" name="categoryId" value="@selectedCategoryId" />
                                    <button class="btn btn-sm btn-light rounded-circle ms-1" style="width:32px;height:32px;">+</button>
                                </form>
                                <span class="fw-semibold ms-3 text-white">@item.Subtotal.ToString("C")</span>
                                <form method="post" asp-page-handler="RemoveFromCart" class="d-inline ms-2">
                                    <input type="hidden" name="productId" value="@item.ProductId" />
                                    <input type="hidden" name="categoryId" value="@selectedCategoryId" />
                                    <button class="btn btn-link text-danger px-1" title="Remove" style="font-size:1.2em;">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        }

                        <div class="mt-3 pb-2">
                            <div class="d-flex justify-content-between text-white-50">
                                <span>Subtotal</span>
                                <span>@subtotal.ToString("C")</span>
                            </div>
                            <div class="d-flex justify-content-between text-white-50">
                                <span>Tax (8%)</span>
                                <span>@tax.ToString("C")</span>
                            </div>
                            <div class="d-flex justify-content-between fs-5 fw-bold text-white mt-2">
                                <span>Total</span>
                                <span>@total.ToString("C")</span>
                            </div>
                        </div>
                        <div class="d-flex gap-2 mt-4">
                            <form method="post" asp-page-handler="ClearCart" class="flex-fill">
                                <button class="btn btn-light w-100 py-2" type="submit">✕ Clear</button>
                            </form>
                            <form method="post" asp-page-handler="Pay" class="flex-fill">
                                <button class="btn btn-dark w-100 py-2" type="submit">
                                    <i class="bi bi-credit-card"></i> Pay
                                </button>
                            </form>
                        </div>
                    }
                    else
                    {
                        <div class="text-muted text-center py-4">Cart is empty.</div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Bootstrap Icons CDN for the trash/pay icon -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
